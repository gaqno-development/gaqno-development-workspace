---
description: Use the Commit and Workflow Agent when committing, pushing, or opening PRs in the workspace. Enforces JIRA hierarchy (Epic → Story → Subtask) and branch naming (epic/, story/).
globs: "**/.git/config,**/push-all.sh,docs/governance/workspace-workflow.md,docs/integrations/github-jira.md"
alwaysApply: false
---

# Commit and Workflow Agent

When the user wants to:

- **Commit** changes (single repo or multiple)
- **Push** branches to remote
- **Open a PR** after pushing
- **Run the full flow** (commit → push → PR) in the workspace

**Use the agent:** `commit-and-workflow-agent`

Select or invoke the agent **commit-and-workflow-agent** (`.cursor/agents/commit-and-workflow-agent.md`). That agent:

1. **Validates Jira hierarchy** before any work: every Subtask MUST have a parent Story, every Story MUST have a parent Epic. If the chain is broken, STOP and ask the user to fix it.
2. **Creates/uses correct branches:**
   - `epic/GAQNO-XXXX` — release branch for the Epic (base: `main`)
   - `story/GAQNO-XXXX` — feature branch for the Story (base: `epic/GAQNO-YYYY`)
   - `GAQNO-XXXX` — bug branch (base: `main`, no prefix)
3. **Commits with subtask keys:** Each commit = one subtask. Format: `GAQNO-XXXX type: description` where GAQNO-XXXX is the **subtask** key and type is `feat`, `fix`, `chore`, `refactor`, `docs`, `test`, `ci`, `style`, or `perf`. NEVER use Story or Epic keys in commit messages.
4. **Opens PRs in the component repo** (not workspace):
   - Story PRs target `epic/GAQNO-YYYY` (parent epic branch)
   - Bug PRs target `main`
   - Epic PRs target `main` (only when all stories are merged)
5. Optionally links branch/PR in Jira via MCP and transitions status.

### Branch hierarchy

```
main
 └── epic/GAQNO-XXXX  (release)
      └── story/GAQNO-XXXX  (feature)
           └── commits: GAQNO-XXXX type: description  (subtasks)
```

### Validation checklist (agent enforces these)

- [ ] Subtask has parent Story in Jira
- [ ] Story has parent Epic in Jira
- [ ] Epic branch exists (`epic/GAQNO-XXXX`)
- [ ] Story branch based off epic branch (`story/GAQNO-XXXX`)
- [ ] Each commit references a subtask key only
- [ ] PR base is the epic branch (for stories) or main (for bugs/releases)
- [ ] PR opened in the correct component repo, not workspace

Do not open PRs in the workspace repo when the change was only inside a submodule; always open the PR in the repo that was changed (see `docs/governance/workspace-workflow.md` and `docs/integrations/github-jira.md`).
