x-buildkit: &buildkit
  DOCKER_BUILDKIT: 1
  COMPOSE_DOCKER_CLI_BUILD: 1

services:
  sso-service:
    build:
      context: ./gaqno-sso-service
      dockerfile: Dockerfile
    container_name: gaqno-sso-service
    ports:
      - "4001:4001"
    environment:
      - NODE_ENV=production
      - PORT=4001
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
      - JWT_ACCESS_EXPIRATION=${JWT_ACCESS_EXPIRATION:-15m}
      - JWT_REFRESH_EXPIRATION=${JWT_REFRESH_EXPIRATION:-7d}
      - COOKIE_DOMAIN=${COOKIE_DOMAIN:-}
      - COOKIE_SECURE=${COOKIE_SECURE:-false}
      - COOKIE_SAME_SITE=${COOKIE_SAME_SITE:-lax}
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network

  pdv-service:
    build:
      context: ./gaqno-pdv-service
      dockerfile: Dockerfile
    container_name: gaqno-pdv-service
    ports:
      - "4006:4006"
    environment:
      - NODE_ENV=production
      - PORT=4006
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
      - SSO_SERVICE_URL=http://sso-service:4001
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started

  shell:
    build:
      context: ./gaqno-shell
      dockerfile: Dockerfile
      args:
        - MFE_AI_URL=http://ai:3002
        - MFE_CRM_URL=http://crm:3003
        - MFE_ERP_URL=http://erp:3004
        - MFE_FINANCE_URL=http://finance:3005
        - MFE_PDV_URL=http://pdv:3006
        - MFE_RPG_URL=http://rpg:3007
        - MFE_SSO_URL=http://sso:3001
        - MFE_SAAS_URL=${MFE_SAAS_URL:-http://localhost:3008}
        - MFE_OMNICHANNEL_URL=http://omnichannel:3010
        - VITE_SERVICE_SSO_URL=http://sso-service:4001
        - VITE_SERVICE_AI_URL=http://ai-service:4002
        - VITE_SERVICE_CRM_URL=http://crm:3003
        - VITE_SERVICE_ERP_URL=http://erp:3004
        - VITE_SERVICE_FINANCE_URL=http://finance-service:4005
        - VITE_SERVICE_PDV_URL=http://pdv-service:4006
        - VITE_SERVICE_RPG_URL=http://rpg-service:4007
        - VITE_SERVICE_OMNICHANNEL_URL=http://omnichannel-service:4008
    container_name: gaqno-shell
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - JWT_SECRET=${JWT_SECRET}
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
      - VITE_SERVICE_AI_URL=http://ai-service:4002
      - VITE_SERVICE_CRM_URL=http://crm:3003
      - VITE_SERVICE_ERP_URL=http://erp:3004
      - VITE_SERVICE_FINANCE_URL=http://finance-service:4005
      - VITE_SERVICE_PDV_URL=http://pdv-service:4006
      - VITE_SERVICE_RPG_URL=http://rpg-service:4007
      - VITE_SERVICE_OMNICHANNEL_URL=http://omnichannel-service:4008
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started
      ai-service:
        condition: service_started
      ai:
        condition: service_started
      crm:
        condition: service_started
      erp:
        condition: service_started
      finance-service:
        condition: service_started
      finance:
        condition: service_started
      pdv:
        condition: service_started
      sso:
        condition: service_started
      omnichannel-service:
        condition: service_started
      omnichannel:
        condition: service_started

  sso:
    build:
      context: ./gaqno-sso
      dockerfile: Dockerfile
    container_name: gaqno-sso
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started

  ai-service:
    build:
      context: ./gaqno-ai-service
      dockerfile: Dockerfile
    container_name: gaqno-ai-service
    ports:
      - "4002:4002"
    environment:
      - NODE_ENV=production
      - PORT=4002
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started

  ai:
    build:
      context: ./gaqno-ai
      dockerfile: Dockerfile
    container_name: gaqno-ai
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=production
      - PORT=3002
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
      - VITE_SERVICE_AI_URL=http://ai-service:4002
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started
      ai-service:
        condition: service_started

  crm:
    build:
      context: ./gaqno-crm
      dockerfile: Dockerfile
    container_name: gaqno-crm
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=production
      - PORT=3003
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network

  erp:
    build:
      context: ./gaqno-erp
      dockerfile: Dockerfile
    container_name: gaqno-erp
    ports:
      - "3004:3004"
    environment:
      - NODE_ENV=production
      - PORT=3004
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network

  finance-service:
    build:
      context: ./gaqno-finance-service
      dockerfile: Dockerfile
    container_name: gaqno-finance-service
    ports:
      - "4005:4005"
    environment:
      - NODE_ENV=production
      - PORT=4005
      - DATABASE_URL=${FINANCE_DATABASE_URL:-${DATABASE_URL}}
      - JWT_SECRET=${JWT_SECRET}
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started

  finance:
    build:
      context: ./gaqno-finance
      dockerfile: Dockerfile
    container_name: gaqno-finance
    ports:
      - "3005:3005"
    environment:
      - NODE_ENV=production
      - PORT=3005
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
      - VITE_SERVICE_FINANCE_URL=http://finance-service:4005
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started
      finance-service:
        condition: service_started

  pdv:
    build:
      context: ./gaqno-pdv
      dockerfile: Dockerfile
    container_name: gaqno-pdv
    ports:
      - "3006:3006"
    environment:
      - NODE_ENV=production
      - PORT=3006
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network

  rpg-service:
    build:
      context: ./gaqno-rpg-service
      dockerfile: Dockerfile
    container_name: gaqno-rpg-service
    ports:
      - "4007:4007"
    environment:
      - NODE_ENV=production
      - PORT=4007
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
      - AI_SERVICE_URL=http://ai-service:4002
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started

  rpg:
    build:
      context: ./gaqno-rpg
      dockerfile: Dockerfile
    container_name: gaqno-rpg
    ports:
      - "3007:3007"
    environment:
      - NODE_ENV=production
      - PORT=3007
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
      - VITE_SERVICE_RPG_URL=http://rpg-service:4007
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started
      rpg-service:
        condition: service_started

  redis:
    image: redis:7-alpine
    container_name: gaqno-redis
    ports:
      - "6379:6379"
    restart: unless-stopped
    networks:
      - gaqno-network

  omnichannel-service:
    build:
      context: ./gaqno-omnichannel-service
      dockerfile: Dockerfile
    container_name: gaqno-omnichannel-service
    ports:
      - "4008:4008"
    environment:
      - NODE_ENV=production
      - PORT=4008
      - DATABASE_URL=${OMNICHANNEL_DATABASE_URL:-${DATABASE_URL}}
      - REDIS_URL=redis://redis:6379/0
      - JWT_SECRET=${JWT_SECRET}
      - SSO_SERVICE_URL=http://sso-service:4001
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started
      redis:
        condition: service_started

  omnichannel:
    build:
      context: ./gaqno-omnichannel
      dockerfile: Dockerfile
      args:
        - VITE_SERVICE_OMNICHANNEL_URL=http://localhost:4008
    container_name: gaqno-omnichannel
    ports:
      - "3010:3010"
    environment:
      - NODE_ENV=production
      - PORT=3010
      - VITE_SERVICE_SSO_URL=http://sso-service:4001
      - VITE_SERVICE_OMNICHANNEL_URL=http://omnichannel-service:4008
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      sso-service:
        condition: service_started
      omnichannel-service:
        condition: service_started

  wellness-service:
    build:
      context: ./gaqno-wellness-service
      dockerfile: Dockerfile
    container_name: gaqno-wellness-service
    ports:
      - "4009:4009"
    environment:
      - NODE_ENV=production
      - PORT=4009
      - DATABASE_URL=${WELLNESS_DATABASE_URL:-${DATABASE_URL}}
      - AI_SERVICE_URL=http://ai-service:4002
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network

  wellness:
    build:
      context: ./gaqno-wellness-ui
      dockerfile: Dockerfile
      args:
        - VITE_SERVICE_WELLNESS_URL=http://localhost:4009
    container_name: gaqno-wellness
    ports:
      - "3011:3011"
    environment:
      - NODE_ENV=production
      - PORT=3011
      - VITE_SERVICE_WELLNESS_URL=http://wellness-service:4009
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gaqno-network
    depends_on:
      wellness-service:
        condition: service_started

networks:
  gaqno-network:
    driver: bridge
