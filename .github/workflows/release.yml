name: Production Release

on:
  push:
    tags:
      - "v*.*.*"

jobs:
  release-governance:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Release Governor
        run: |
          cursor agent run release-governor \
            --mode hard-gate \
            --output report.json

      - name: Evaluate Decision
        run: |
          DECISION=$(jq -r '.decision' report.json)

          if [ "$DECISION" = "BLOCKED" ]; then
            echo "ðŸš« Release blocked by Release Governor"
            exit 1
          fi
  deploy:
    needs: release-governance
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to Production
        run: |
          ./deploy.sh
